# {{ ansible_managed }}
[Unit]
Description=Print Nanny Update Service
After=network.target network-online.target printnanny-metadata.target
Wants=network.service network-online.target printnanny-metadata.target

[Service]
Type=oneshot
RuntimeDirectory={{ updater_app_name }}
ConfigurationDirectory={{ updater_app_name }}

ExecStart={{ updater_venv }}/bin/ansible-galaxy \
    collection install --upgrade {{ updater_collection_url }}

{% for playbook in updater_playbooks %}
ExecStart=/usr/bin/flock -F {{ ansible_lockfile }} \
    {{ updater_venv }}/bin/ansible-playbook \
    {{ playbook }}
{% endfor %}
ExecStartPost=-/usr/bin/flock -F {{ ansible_lockfile }} \
    /usr/bin/rm {{ ansible_lockfile }}
Restart=on-failure

[Install]
WantedBy=multi-user.target