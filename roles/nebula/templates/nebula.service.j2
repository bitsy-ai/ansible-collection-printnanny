# {{ ansible_managed }}
[Unit]
Description=Nebula
Wants=basic.target
After=basic.target network.target
Before=sshd.service

[Service]
ExecStartPre=/usr/local/bin/nebula -test -config {{ nebula_config_file }}
ExecStart=/usr/local/bin/nebula -config {{ nebula_config_file }}
ExecReload=/bin/kill -HUP $MAINPID

RuntimeDirectory={{ nebula_user }}
ConfigurationDirectory={{ nebula_user }}
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
ProtectControlGroups=true
ProtectHome=true
ProtectKernelTunables=true
ProtectSystem=full
User={{ nebula_user }}
Group={{ nebula_user }}

SyslogIdentifier={{ nebula_user }}

Restart=always
RestartSec=2
TimeoutStopSec=5
StartLimitInterval=0
LimitNOFILE=131072

[Install]
WantedBy=multi-user.target