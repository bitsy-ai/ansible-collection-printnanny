---
- name: debug janus_upgrade_available={{ janus_upgrade_available }}
  ansible.builtin.debug:
    msg: 'janus_version={{ janus_version }} ansible_local.janus={{ ansible_local.janus }}'
  when: ansible_local.janus is defined

# all tasks requiring access to secrets must appear after this task
- include_tasks: metadata/main.yml
- include_tasks: build/main.yml
  when: janus_build_source == True and janus_upgrade_available

- include_tasks: factsd.yml
- name: Update /etc/systemd/system/janus.service
  become: true
  ansible.builtin.template:
    mode: 0644
    src: systemd/janus.service.j2
    dest: /etc/systemd/system/janus.service
    force: true
  notify:
    - restart janus

- include_tasks: metadata/async_status.yml
