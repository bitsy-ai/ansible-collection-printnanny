[Unit]
Description=Janus Gateway
Requires=network.target
After=syslog.target network.target network-online.target
{% if janus_service_unit_extra is defined %}
{{ janus_service_unit_extra }}
{% endif %}

[Service]
Type=simple
User={{ janus_user }}
RuntimeDirectory={{ janus_user }}
LogsDirectory={{ janus_user }}
RuntimeDirectoryMode=755
WorkingDirectory={{ janus_install_dir }}
{% if ansible_local.license.janus_admin_secret is defined %}
Environment=JANUS_ADMIN_SECRET={{ ansible_local.license.janus_admin_secret }}
{% endif %}
{% if ansible_local.license.janus_token is defined %}
Environment=JANUS_TOKEN={{ ansible_local.license.janus_token }}
{% endif %} 
ExecStart={{ janus_install_dir }}/bin/janus \
    --cwd-path={{ janus_install_dir }} \
    --configs-folder={{ janus_conf_dir }} \
    --log-file={{ janus_log_file }}

{% for cmd in janus_exec_start_post %}
ExecStartPost={{ cmd }}
{% endfor %}
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target